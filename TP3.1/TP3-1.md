# TP 3.1 XQuery

> Ce TP sur XQuery est principalement basé sur l'utilisation d'ExchangerXML. 
> Il n'existe pas encore beaucoup de solutions disponibles en logiciels libres pour utiliser un moteur d'interprétation XQuery. 
> Toutefois si vous souhaitez en utiliser une autre, libre à vous (et, le cas échéant, merci de faire remonter les bonnes trouvailles à votre enseignant).

## 1. Prise en main de XQuery dans Exhanger XML

Pour vous familiariser avec XQuery, Exchanger XML propose un exemple permettant de mettre en œuvre le moteur d'interprétation. Les fichiers composant l'exemple sont accessibles dans l'onglet "Projects" (habituellement affiché en zone gauche de votre écran), dossier XQuery.

**Attention :** Vous pouvez aussi aller chercher les fichiers dans le répertoire Projets dans "Program Files/Exchanger...".

Au cas où : L'archive avec l'exemple XQuery.

### À faire :
- Regénérez le résultat de la requête XQuery `books.xq`.
- Ensuite, définissez les requêtes permettant de :
  - Sélectionner les livres présents en stock par ordre de prix décroissant. Pour chaque livre, on affichera uniquement la valeur des éléments `TITRE` et `PRICE` dans des balises xhtml, le premier dans une police de couleur jaune, le second bleu.
  - Faire la facture pour l'achat de deux livres particuliers (à choisir). Votre requête devra définir au minimum les variables permettant d'accéder aux livres, afficher leur titre et le prix total (les prix doivent être récupérés dans `books.xml`).
  **Attention :** les variables dans XQuery ne sont pas modifiables (propriétés d'un langage fonctionnel). Il faut donc traiter les 2 livres en une seule expression FLOWER (par exemple avec 2 variables), et réaliser la somme des prix avec un `let` interne unique (pas d'accumulateur).
  - Relever pour chaque catégorie de livre le nombre des livres appartenant à cette catégorie présents en stock. La catégorie devra être indiquée explicitement.

## 2. Les livres et les auteurs

L'objectif est d'interroger les documents `films.xml` et `artistes.xml` avec XQuery. 
Pour faire des requêtes XQuery nous utiliserons Exchanger XML. 
Vous remarquerez que certaines questions ont déjà été posées dans l'exercice 1 du TP sur XPath, vous pouvez ainsi comparer les résultats obtenus entre les requêtes XPath et XQuery.

### À faire :
Avec Exchanger XML, faites les recherches suivantes sur les fichiers `films.xml` et `artistes.xml` :

- Pour s'échauffer : 3+8 ?
- De quelle année est le film « Le retour du Jedi » ?
- Quels sont les titres de tous les films d'horreurs ? Les titres ne devront plus apparaître en attribut mais en valeur textuelle d'une balise `<film>`.
- Quels sont les titres (affichés en attribut d'une balise `<film>`) et années (affichées en élément de `<film>`) des films dramatiques tournés par Hitchcock ?
- Quels sont les films dans lesquels a tourné John Travolta ? Afficher tous les détails.
- Quel est le film qui précède immédiatement "Léon" dans le document ?
- Combien de films sont proposés dans chaque genre ?
- Quels sont les acteurs qui ont joué dans plus d'un film ? Afficher pour chaque acteur le compte correspondant.
- Afficher la liste des metteurs en scène, avec pour chacun d'eux la liste de leurs films.
- Construire une requête qui détermine pour chaque acteur la liste des titres de films dans lesquels il a joué. Par exemple, pour l'acteur Travolta on veut obtenir la sortie suivante :

```xml
  <ACTEUR>
    <NOM>Travolta</NOM>
    <FILMS>
      <FILM titre="Volte/Face"/>
      <FILM titre="Pulp fiction"/>
    </FILMS>
  </ACTEUR>
```